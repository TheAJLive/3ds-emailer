<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>3DS → Phone: Image Uploader</title>
<style>
  :root{--bg:#0d1117;--fg:#e6edf3;--muted:#8b949e;--card:#161b22;--line:#262b33;--accent:#58a6ff;--ok:#2ea043;--bad:#f85149;}
  *{box-sizing:border-box}
  html,body{margin:0;padding:0;background:var(--bg);color:var(--fg);font:14px/1.35 -apple-system,BlinkMacSystemFont,Segoe UI,Arial,sans-serif}
  header{padding:10px;border-bottom:1px solid #222;background:#0b0f14;position:sticky;top:0;z-index:10}
  header h1{margin:0;font-size:16px}
  main{max-width:700px;margin:0 auto;padding:14px}
  .card{background:var(--card);border:1px solid var(--line);border-radius:10px;padding:12px;margin:10px 0}
  .row{display:flex;align-items:center;gap:8px}
  .grid{display:grid;grid-template-columns:1fr;gap:10px}
  @media (min-width:560px){.grid2{grid-template-columns:1fr 1fr}}
  .btn{display:inline-block;border:1px solid var(--line);background:#0f141b;color:var(--fg);padding:8px 10px;border-radius:8px;font-weight:700;text-decoration:none}
  .btn[disabled]{opacity:.5}
  .pill{display:inline-block;border:1px solid var(--line);border-radius:999px;padding:2px 8px;color:var(--muted);font-size:12px;margin-right:6px}
  .muted{color:var(--muted)}
  .ok{color:var(--ok)} .bad{color:var(--bad)}
  .thumbs{display:flex;flex-wrap:wrap;gap:8px;margin-top:8px}
  .thumb{border:1px solid var(--line);border-radius:8px;overflow:hidden;width:84px;height:84px;background:#0b0f14;display:flex;align-items:center;justify-content:center}
  .thumb img{max-width:100%;max-height:100%;display:block}
  .list{border-top:1px solid var(--line);margin-top:8px}
  .item{display:flex;gap:8px;align-items:center;padding:8px 0;border-bottom:1px solid var(--line)}
  .item:last-child{border-bottom:0}
  .mono{font-family:ui-monospace,Menlo,Consolas,monospace;word-break:break-all}
  .qr{width:120px;height:120px;border:1px solid var(--line);border-radius:8px;background:#0b0f14}
  progress{width:100%;height:12px}
  .center{text-align:center}
</style>
</head>
<body>
<header><h1>3DS → Phone: Image Uploader</h1></header>
<main>
  <section class="card">
    <div class="row" style="justify-content:space-between">
      <div><span class="pill">Static</span><span class="pill">No login</span><span class="pill">Multi-image</span></div>
      <div class="muted">Tip: Scan the QR codes with your phone.</div>
    </div>
  </section>

  <section class="card">
    <div class="grid grid2">
      <label>
        <div class="muted">Pick images (multiple OK)</div>
        <input id="fileIn" type="file" accept="image/*" multiple style="margin-top:6px;width:100%">
      </label>
      <div>
        <div class="muted">Upload target</div>
        <div class="row" style="margin-top:6px;gap:6px;flex-wrap:wrap">
          <button id="upLitter" class="btn">Upload (Temporary 12h)</button>
          <button id="upCatbox" class="btn">Upload (Permanent)</button>
          <button id="clearBtn" class="btn" title="Clear results">Clear</button>
        </div>
      </div>
    </div>
    <div id="thumbs" class="thumbs"></div>
    <div id="status" class="muted" style="margin-top:8px">No files selected.</div>
    <div style="margin-top:8px"><progress id="prog" max="100" value="0" hidden></progress></div>
  </section>

  <section class="card">
    <h3 style="margin:4px 0 8px">Results</h3>
    <div class="list" id="results"></div>
    <div class="muted" id="note" style="margin-top:8px"></div>
  </section>

  <section class="card">
    <h3 style="margin:4px 0 8px">How to use (quick)</h3>
    <ol style="margin:0 0 6px 18px">
      <li>On your 3DS, open this page, pick multiple images, press an Upload button.</li>
      <li>Each uploaded file shows a URL and a QR. Scan the QR with your phone to download.</li>
    </ol>
    <div class="muted">Temporary = expires (~12 hours). Permanent = doesn’t expire. If temporary fails, try Permanent.</div>
  </section>

  <p class="center muted">© demo. uses third-party file hosts. no tracking.</p>
</main>

<script>
(function(){
  // Endpoints (try Litterbox first; fall back to Catbox)
  var ENDPOINT = {
    LITTERBOX: 'https://litterbox.catbox.moe/resources/internals/api.php',
    CATBOX:    'https://catbox.moe/user/api.php'
  };

  // Elements
  function q(id){ return document.getElementById(id); }
  var fileIn = q('fileIn'), thumbs = q('thumbs'), status = q('status'), results = q('results');
  var upLitter = q('upLitter'), upCat = q('upCatbox'), prog = q('prog'), note = q('note'), clearBtn = q('clearBtn');

  // State
  var files = [];

  function fmtBytes(n){
    var u=['B','KB','MB','GB']; var i=0; while(n>=1024 && i<u.length-1){ n/=1024; i++; }
    return (Math.round(n*10)/10)+' '+u[i];
  }

  function renderThumbs(){
    thumbs.innerHTML='';
    if(!files.length){ status.textContent='No files selected.'; return; }
    for(var i=0;i<files.length;i++){
      (function(file){
        var div=document.createElement('div'); div.className='thumb';
        var img=document.createElement('img');
        // Show tiny preview (safe for 3DS)
        var r=new FileReader();
        r.onload=function(){ img.src=r.result; };
        r.readAsDataURL(file);
        div.appendChild(img); thumbs.appendChild(div);
      })(files[i]);
    }
    status.textContent=files.length+' file(s) selected, total ~'+fmtBytes(files.reduce(function(a,f){return a+f.size;},0));
  }

  fileIn.addEventListener('change', function(){
    files = Array.prototype.slice.call(fileIn.files||[]);
    renderThumbs();
  }, false);

  clearBtn.addEventListener('click', function(){
    files=[]; fileIn.value=''; thumbs.innerHTML=''; results.innerHTML=''; status.textContent='Cleared.'; prog.hidden=true; note.textContent='';
  }, false);

  function setBusy(b){
    upLitter.disabled=b; upCat.disabled=b; fileIn.disabled=b;
    if(!b){ prog.hidden=true; } else { prog.hidden=false; prog.value=0; }
  }

  function xhrUpload(url, fieldsObj, file, cb){
    try{
      var fd = new FormData();
      // Shared param for both APIs
      fd.append('reqtype','fileupload');
      // Litterbox time (optional)
      if(fieldsObj && fieldsObj.time) fd.append('time', fieldsObj.time);
      fd.append('fileToUpload', file, file.name);

      var x = new XMLHttpRequest();
      x.open('POST', url, true);
      x.onreadystatechange = function(){
        if(x.readyState===4){
          if(x.status===200){ cb(null, (x.responseText||'').trim()); }
          else { cb(new Error('HTTP '+x.status)); }
        }
      };
      x.send(fd);
    }catch(e){ cb(e); }
  }

  function makeQR(url){
    // Use a public QR image API to avoid heavy JS libs on 3DS.
    var api = 'https://api.qrserver.com/v1/create-qr-code/?size=240x240&data='+encodeURIComponent(url);
    var img=document.createElement('img'); img.className='qr'; img.alt='QR'; img.src=api;
    return img;
  }

  function addResult(fileName, link, tag){
    var row=document.createElement('div'); row.className='item';
    var meta=document.createElement('div'); meta.style.flex='1';
    var a=document.createElement('a'); a.href=link; a.textContent=fileName; a.target='_blank'; a.rel='noreferrer';
    var small=document.createElement('div'); small.className='mono muted'; small.textContent=link;
    meta.appendChild(a); meta.appendChild(small);
    var badge=document.createElement('div'); badge.className='pill'; badge.textContent=tag||'OK';
    var qr = makeQR(link);
    row.appendChild(qr); row.appendChild(meta); row.appendChild(badge);
    results.appendChild(row);
  }

  function uploadAll(which){
    if(!files.length){ alert('Pick images first.'); return; }
    setBusy(true); results.innerHTML=''; note.textContent='';
    var i=0, ok=0, fail=0, total=files.length;
    prog.value=0; prog.max=total;

    function next(){
      if(i>=total){
        setBusy(false);
        var msg = ok+' uploaded, '+fail+' failed.';
        status.textContent = msg;
        return;
      }
      var file = files[i++];
      status.textContent = 'Uploading '+file.name+' ('+i+'/'+total+')…';
      var primaryURL = (which==='litter')? ENDPOINT.LITTERBOX : ENDPOINT.CATBOX;
      var primaryFields = (which==='litter')? {time:'12h'} : {};

      xhrUpload(primaryURL, primaryFields, file, function(err, link){
        if(!err && link && link.indexOf('http')===0){
          ok++; prog.value=ok+fail; addResult(file.name, link, which==='litter'?'TEMP':'PERM'); next(); return;
        }
        // fallback if chosen Litterbox fails
        if(which==='litter'){
          xhrUpload(ENDPOINT.CATBOX, {}, file, function(err2, link2){
            if(!err2 && link2 && link2.indexOf('http')===0){
              ok++; prog.value=ok+fail; addResult(file.name, link2, 'PERM (fallback)'); note.innerHTML='<span class="bad">Temporary upload failed — used permanent fallback.</span>';
            }else{
              fail++; prog.value=ok+fail;
            }
            next();
          });
        }else{
          fail++; prog.value=ok+fail; next();
        }
      });
    }
    next();
  }

  upLitter.addEventListener('click', function(){ uploadAll('litter'); }, false);
  upCat.addEventListener('click', function(){ uploadAll('cat'); }, false);

  // Basic sanity info for 3DS
  (function(){
    var ua = navigator.userAgent||'';
    var info = document.createElement('div');
    info.className='muted'; info.style.marginTop='8px';
    info.textContent='UA: '+ua;
    document.querySelector('section.card').appendChild(info);
  })();
})();
</script>
</body>
</html>